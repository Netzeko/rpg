<script src="toolbox.js"></script>

<script>
	class Save{
		constructor() {
			this.health = 10;
			this.maxhealth = 10;
			this.exp = 0;
			this.playername = 'Zero';
		}
		
		
		loadFromCookie(savename = ''){
			var data = getCookie('save'+savename);
			if(data.length == 0){
				return false;
			}
			var dataArray = data.split('/');
			console.log('loading '+savename+', '+dataArray.length+' properties');
			for(var i = 0;i<dataArray.length;i++){
				
				var variable = dataArray[i].split(':');
				if(variable[0].length ==0) continue;
				
				console.log('prop '+variable[0]+'='+variable[1]+' ('+variable[2]+')');
				if(variable[2].localeCompare('number') == 0){
					this[variable[0]] = Number(variable[1]);
				}else if(variable[2].localeCompare('string') == 0){
					this[variable[0]] = variable[1];
				}
				//console.log('saved as '+typeof this[variable[0]]);
				
			}

		}
		
		saveInCookie(savename = ''){
			console.log('saving '+savename);
			var keys = Object.keys(this);
			var savetext = '';
			for(var i = 0;i<keys.length;i++){
				//console.log('prop '+keys[i]);
				savetext+=''+keys[i]+':'+this[keys[i]]+':'+(typeof this[keys[i]])+'/';
			}
			setCookie('save'+savename,savetext);
		}
		
		showProperty(prop){			
			var htmlout = document.getElementById(prop);
			if(htmlout){
				htmlout.innerHTML = this[prop];
			}
		}
		
		showProperties(){
			var keys = Object.keys(this);
			for(var i = 0;i<keys.length;i++){
				this.showProperty(keys[i]);
			}
		}
		
		regenerate(){
			if(this.health < this.maxhealth){
				this.health += 1;
				this.showProperty('health');
			}
			setTimeout("s.regenerate()",2000);
		}
		
		
		attack(){
			if(this.health > 0){
				this.health -= 1;
				this.exp += 1;
				this.showProperty('health');
				this.showProperty('exp');
			}
		}
		
		
		init(){
			console.log('Initialize');
			this.showProperties();
			setTimeout(this.regenerate,2000);
			console.log('End initialize');
		}
	}

	var s = new Save();
	s.loadFromCookie();
	
	 
	
	
	//setCookie('test','01');
	console.log('save='+getCookie('save'));
</script>

name : <span id="playername"></span><br/>
health : <span id="health"></span>/<span id="maxhealth"></span><br/>
exp : <span id="exp"></span><br/>
<input type="button" value="attack" onclick="s.attack()"/>
<input type="button" value="save" onclick="s.saveInCookie()"/>


<script>
	s.init();
	
</script>














